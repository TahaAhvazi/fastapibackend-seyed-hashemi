# سبد خرید و سفارش‌گیری عمومی - Cart Feature

این فیچر امکان ثبت سفارش عمومی بدون نیاز به احراز هویت را فراهم می‌کند و ادمین/حسابدار می‌توانند این سفارشات را مدیریت کنند.

## ویژگی‌های کلیدی

### 1. ثبت سفارش عمومی (بدون احراز هویت)
- مشتریان می‌توانند بدون ثبت‌نام محصولات را انتخاب کنند
- اطلاعات تماس و آدرس مشتری دریافت می‌شود
- لیست اقلام با قیمت و تعداد ثبت می‌شود

### 2. مدیریت سفارشات توسط ادمین/حسابدار
- مشاهده لیست تمام سفارشات
- تغییر وضعیت سفارشات (در حال بررسی، تایید شده، رد شده)
- مشاهده جزئیات کامل هر سفارش
- آمار و گزارشات سفارشات

## مدل‌های داده

### Cart (سبد خرید)
- `id`: شناسه یکتا
- `customer_name`: نام و نام خانوادگی مشتری
- `customer_phone`: شماره تماس مشتری
- `customer_email`: ایمیل مشتری (اختیاری)
- `customer_address`: آدرس مشتری (اختیاری)
- `notes`: یادداشت‌های اضافی (اختیاری)
- `total_amount`: مجموع مبلغ سفارش
- `status`: وضعیت سفارش (pending, reviewed, approved, rejected)
- `created_at`, `updated_at`: زمان ایجاد و به‌روزرسانی

### CartItem (آیتم‌های سبد)
- `id`: شناسه یکتا
- `cart_id`: شناسه سبد خرید
- `product_id`: شناسه محصول
- `quantity`: تعداد
- `unit`: واحد (متر، یارد، طاقه)
- `price`: قیمت هر واحد
- `total_price`: قیمت کل (محاسبه شده)

## اندپوینت‌ها

### 1. ثبت سفارش عمومی (بدون احراز هویت)
```
POST /api/v1/carts/public/submit
```

**Body:**
```json
{
  "customer_name": "احمد محمدی",
  "customer_phone": "09123456789",
  "customer_email": "ahmad@example.com",
  "customer_address": "تهران، خیابان ولیعصر، پلاک 123",
  "notes": "لطفاً در بسته‌بندی دقت کنید",
  "items": [
    {
      "product_id": 1,
      "quantity": 5,
      "unit": "متر",
      "price": 350000
    },
    {
      "product_id": 2,
      "quantity": 3,
      "unit": "یارد",
      "price": 280000
    }
  ]
}
```

**Response:**
```json
{
  "id": 1,
  "message": "سفارش شما با موفقیت ثبت شد. کد پیگیری: #1",
  "total_amount": 2590000
}
```

### 2. لیست سفارشات (ادمین/حسابدار)
```
GET /api/v1/carts/
```

**Query Parameters:**
- `status`: فیلتر بر اساس وضعیت
- `skip`: تعداد رکوردهای رد شده
- `limit`: تعداد رکوردهای برگشتی

### 3. جزئیات سفارش (ادمین/حسابدار)
```
GET /api/v1/carts/{cart_id}
```

### 4. تغییر وضعیت سفارش (ادمین/حسابدار)
```
PUT /api/v1/carts/{cart_id}
```

**Body:**
```json
{
  "status": "approved"
}
```

**وضعیت‌های ممکن:**
- `pending`: در انتظار بررسی
- `reviewed`: بررسی شده
- `approved`: تایید شده
- `rejected`: رد شده

### 5. حذف سفارش (فقط ادمین)
```
DELETE /api/v1/carts/{cart_id}
```

### 6. آمار سفارشات (ادمین/حسابدار)
```
GET /api/v1/carts/stats/summary
```

**Response:**
```json
{
  "total_orders": 150,
  "total_amount": 45000000,
  "status_breakdown": {
    "pending": 25,
    "reviewed": 30,
    "approved": 80,
    "rejected": 15
  }
}
```

## اعتبارسنجی

### اطلاعات مشتری
- نام: حداقل 2 و حداکثر 100 کاراکتر
- شماره تلفن: حداقل 10 رقم
- ایمیل: فرمت صحیح ایمیل (در صورت ارائه)
- آدرس: حداکثر 500 کاراکتر
- یادداشت: حداکثر 1000 کاراکتر

### آیتم‌های سفارش
- محصول باید موجود باشد
- تعداد باید بیشتر از صفر باشد
- قیمت باید بیشتر از صفر باشد
- حداقل یک آیتم باید در سفارش باشد

## مجوزهای دسترسی

### عمومی
- ثبت سفارش: بدون احراز هویت

### ادمین
- مشاهده لیست سفارشات
- مشاهده جزئیات سفارش
- تغییر وضعیت سفارش
- حذف سفارش
- مشاهده آمار

### حسابدار
- مشاهده لیست سفارشات
- مشاهده جزئیات سفارش
- تغییر وضعیت سفارش
- مشاهده آمار

## پیاده‌سازی در فرانت‌اند

### صفحه عمومی (بدون لاگین)
1. لیست محصولات قابل انتخاب
2. فرم اطلاعات مشتری
3. سبد خرید با امکان حذف/تغییر تعداد
4. محاسبه خودکار مجموع مبلغ
5. ارسال سفارش و نمایش پیام موفقیت

### پنل ادمین/حسابدار
1. لیست سفارشات با فیلتر وضعیت
2. جزئیات هر سفارش
3. دکمه‌های تغییر وضعیت
4. صفحه آمار و گزارشات

## نکات مهم

1. **امنیت**: اندپوینت عمومی فقط برای ثبت سفارش است و هیچ اطلاعات حساسی را برنمی‌گرداند
2. **اعتبارسنجی**: همه ورودی‌ها اعتبارسنجی می‌شوند
3. **پیگیری**: هر سفارش یک کد پیگیری یکتا دارد
4. **مدیریت موجودی**: فعلاً موجودی محصولات چک نمی‌شود (می‌توان در آینده اضافه کرد)
5. **اطلاع‌رسانی**: می‌توان در آینده سیستم اطلاع‌رسانی اضافه کرد

## مثال استفاده کامل

### 1. مشتری سفارش می‌دهد
```bash
curl -X POST "http://localhost:8000/api/v1/carts/public/submit" \
  -H "Content-Type: application/json" \
  -d '{
    "customer_name": "علی احمدی",
    "customer_phone": "09123456789",
    "customer_email": "ali@example.com",
    "customer_address": "تهران، خیابان کریمخان، پلاک 45",
    "notes": "لطفاً در صبح ارسال شود",
    "items": [
      {
        "product_id": 1,
        "quantity": 10,
        "unit": "متر",
        "price": 300000
      }
    ]
  }'
```

### 2. ادمین سفارشات را می‌بیند
```bash
curl -X GET "http://localhost:8000/api/v1/carts/" \
  -H "Authorization: Bearer <admin_token>"
```

### 3. ادمین وضعیت را تغییر می‌دهد
```bash
curl -X PUT "http://localhost:8000/api/v1/carts/1" \
  -H "Authorization: Bearer <admin_token>" \
  -H "Content-Type: application/json" \
  -d '{"status": "approved"}'
```

این فیچر آماده استفاده است و می‌تواند به راحتی در فرانت‌اند پیاده‌سازی شود.
